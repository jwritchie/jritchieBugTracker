@model jritchieBugTracker.Models.CodeFirst.Ticket

@{
    ViewBag.Title = "Ticket Details";
}


<div class="container">

    <div class="row" style="margin-top:10px">
        <div class="col-sm-12">
            <div class="card-box table-responsive">

                <div class="row">
                    <h4 class="header-title m-t-0 m-b-30">Ticket Details</h4>

                    <div class="col-md-6">
                        <dl class="dl-horizontal">
                            <dt>
                                Ticket ID
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Id)
                            </dd>
                            <dt>
                                Ticket Name
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Title)
                            </dd>
                            <dt>
                                Type of issue
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.TicketType.Name)
                            </dd>
                            <dt>
                                Project
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Project.Title)
                            </dd>
                            <dt>&nbsp;</dt>
                            <dd>&nbsp;</dd>
                            <dt>
                                Priority
                            </dt>
                            <dd>
                                @if (Model.TicketPriority.Name == "Urgent")
                                {
                                    <span class="label label-urgent">Urgent</span>
                                }
                                else if (Model.TicketPriority.Name == "High")
                                {
                                    <span class="label label-high">High</span>
                                }
                                else if (Model.TicketPriority.Name == "Medium")
                                {
                                    <span class="label label-medium">Medium</span>
                                }
                                else if (Model.TicketPriority.Name == "Low")
                                {
                                    <span class="label label-low">Low</span>
                                }
                            </dd>
                            <dt>
                                Status
                            </dt>
                            <dd>
                                @if (Model.TicketStatus.Name == "Resolved")
                                {
                                    <span class="label label-success">Resolved</span>
                                }
                                else if (Model.TicketStatus.Name == "In Progress")
                                {
                                    <span class="label label-info">In Progress</span>
                                }
                                else if (Model.TicketStatus.Name == "Assigned")
                                {
                                    <span class="label label-purple">Assigned</span>
                                }
                                else if (Model.TicketStatus.Name == "Unassigned")
                                {
                                    <span class="label label-pink">Unassigned</span>
                                }
                            </dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="dl-horizontal">
                            <dt>
                                Created
                            </dt>
                            <dd>
                                @Html.ToUserTime(Model.Created, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss")
                            </dd>
                            <dt>
                                @Html.DisplayNameFor(model => model.Updated)
                            </dt>
                            <dd>
                                @if (Model.Updated == null)
                                {
                                    <span>-</span>
                                }
                                else
                                {
                                    @Html.ToUserTime(Model.Updated.Value, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss")
                                }
                            </dd>
                            <dt>&nbsp;</dt>
                            <dd>&nbsp;</dd>
                            <dt>
                                Ticket Submitter
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.OwnerUser.Fullname)
                            </dd>

                            <dt>
                                Assigned Developer
                            </dt>
                            <dd>
                                @if (Model.AssignToUserId == null)
                                {
                                    <span>-</span>
                                }
                                else
                                {
                                    @Html.DisplayFor(model => model.AssignToUser.Fullname)
                                }
                            </dd>
                        </dl>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <dl class="dl-horizontal">
                            <dt>
                                Issue Description
                            </dt>
                            <dd>
                                @Html.DisplayFor(model => model.Description)
                            </dd>
                        </dl>
                    </div>
                </div>

                <hr />

                <div class="row">
                    <div class="col-md-12" style="text-align:center">
                        <p>
                            <a href="@Url.Action("Edit", new { id = Model.Id } )"><i class="fa fa-pencil-square-o"></i><span> Edit Ticket</span></a> 

                            @if (User.IsInRole("Admin") || User.IsInRole("ProjectManager"))
                            {
                                <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                                <a href="@Url.Action("AssignTicketUser", new { ticketId = Model.Id } )"><i class="fa fa-user-plus"></i><span> Assign Developer </span></a>
                                @*@Html.ActionLink("Delete", "Delete", new { id=item.Id })*@
                            }
                            <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                            <a href="@Url.Action("Index")"><i class="fa fa-ticket"></i><span> Return to Tickets </span></a>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Ticket Additional Information begins here -->
    <div class="row">
        <div class="col-sm-12">
            <div class="card-box table-responsive">

                <h4 class="header-title m-t-0 m-b-30">Additional Information</h4>

                <div class="row">
                    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

                        <!-- Comments -->
                        <div class="panel panel-default bx-shadow-none">
                            <div class="panel-heading" role="tab" id="headingOne">
                                <p class="panel-title" style="font-weight:500">
                                    <a class="collapsed" role="button" data-toggle="collapse"
                                       data-parent="#accordion" href="#collapseOne"
                                       aria-expanded="false" aria-controls="collapseOne">
                                        @if (Model.Comments.Count != 0)
                                        {
                                            if (Model.Comments.Count == 1)
                                            {
                                                @Model.Comments.Count<span> Comment</span>
                                            }
                                            else
                                            {
                                                @Model.Comments.Count<span> Comments</span>
                                            }
                                        }
                                        else
                                        {
                                            <span>No Comments</span>
                                        }
                                    </a>
                                </p>
                            </div>
                            <div id="collapseOne" class="panel-collapse collapse"
                                 role="tabpanel" aria-labelledby="headingOne">
                                <div class="panel-body">

                                    <div class="row">
                                        @{
                                            // Alternate background-color of Comments display.
                                            bool commentFieldLight = true;

                                            foreach (var comment in Model.Comments.OrderByDescending(c => c.Id))
                                            {
                                                if (commentFieldLight)   // Comment with light background.
                                                {
                                                    <div style="padding:6px; background-color:#ebeff2; box-shadow:2px 2px 3px rgba(30,30,30,0.25)">
                                                        <p style="font-size:smaller">
                                                            <span style="font-weight:bold">
                                                                Posted:
                                                            </span>@Html.ToUserTime(comment.Created, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss"): &nbsp;<span style="font-weight:bold">@comment.Author.Fullname</span> said:
                                                        </p>
                                                        <p>@comment.Body</p>

                                                        @{  // Display Comment-Update information if available.
                                                            if (comment.Updated != null)
                                                            {
                                                                <div style="border:1px solid #93a8b8; margin: 0px 10px 6px 10px; padding: 10px 10px 0px 10px">
                                                                    <p style="font-size:smaller"><span style="font-weight:bold">Edited: </span>@Html.ToUserTime(comment.Updated.Value, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss")</p>
                                                                </div>
                                                            }
                                                        }

                                                        @{  // Allow Editing/Deleting Comments.
                                                            if (User.IsInRole("Admin") ||
                                                            (User.IsInRole("ProjectManager") && Model.Project.Users.Any(u => u.Id == ViewBag.UserId)) ||
                                                            comment.AuthorId == ViewBag.UserId)
                                                            {
                                                                <div style="text-align:center">
                                                                    <a href="@Url.Action("Edit", "TicketComments", new { id = comment.Id } )"><i class="fa fa-pencil-square-o"></i><span> Edit Comment </span></a>
                                                                    &nbsp;&nbsp;|&nbsp;&nbsp;
                                                                    <a href="@Url.Action("Delete", "TicketComments", new { id = comment.Id } )"><i class="fa fa-trash"></i><span> Delete Comment </span></a>
                                                                </div>
                                                            }
                                                        }
                                                    </div>

                                                    commentFieldLight = false;
                                                }
                                                else                    // Comment with Dark background.
                                                {
                                                    <div style="padding:6px; background-color:#d1dae1; box-shadow:2px 2px 3px rgba(30,30,30,0.25)">
                                                        <p style="font-size:smaller">
                                                            <span style="font-weight:bold">
                                                                Posted:
                                                            </span>@Html.ToUserTime(comment.Created, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss"): &nbsp;<span style="font-weight:bold">@comment.Author.Fullname</span> said:
                                                        </p>
                                                        <p>@comment.Body</p>

                                                        @{  // Display Comment-Update information if available.
                                                            if (comment.Updated != null)
                                                            {
                                                                <div style="border:1px solid #93a8b8; margin: 0px 10px 6px 10px; padding: 10px 10px 0px 10px">
                                                                    <p style="font-size:smaller"><span style="font-weight:bold">Edited: </span>@Html.ToUserTime(comment.Updated.Value, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss")</p>
                                                                </div>
                                                            }
                                                        }

                                                        @{  // Allow Editing/Deleting Comments.
                                                            if (User.IsInRole("Admin") ||
                                                            (User.IsInRole("ProjectManager") && Model.Project.Users.Any(u => u.Id == ViewBag.UserId)) ||
                                                            comment.AuthorId == ViewBag.UserId)
                                                            {
                                                                <div style="text-align:center">
                                                                    <a href="@Url.Action("Edit", "TicketComments", new { id = comment.Id } )"><i class="fa fa-pencil-square-o"></i><span> Edit Comment </span></a>
                                                                    &nbsp;&nbsp;|&nbsp;&nbsp;
                                                                    <a href="@Url.Action("Delete", "TicketComments", new { id = comment.Id } )"><i class="fa fa-trash"></i><span> Delete Comment </span></a>
                                                                </div>
                                                            }
                                                        }
                                                    </div>

                                                    commentFieldLight = true;
                                                }
                                                <hr />
                                            }
                                        }

                                        @{if (Request.IsAuthenticated)    // Confirm user is logged in before allowing Comment creation.
                                            {
                                                using (Html.BeginForm("Create", "TicketComments", new { TicketId = Model.Id }, FormMethod.Post, null))
                                                {
                                                    @Html.AntiForgeryToken()
                                                    <div>
                                                        <textarea rows="5" name="Body" style="max-width:none !important; width:100%">@ViewBag.Comment</textarea>
                                                        <button class="btn btn-primary center-block" type="submit">Submit Comment</button>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>

                                </div>
                            </div>
                        </div>

                        <!-- Attachments -->
                        <div class="panel panel-default bx-shadow-none">
                            <div class="panel-heading" role="tab" id="headingTwo">
                                <p class="panel-title" style="font-weight:500">
                                    <a class="collapsed" role="button" data-toggle="collapse"
                                       data-parent="#accordion" href="#collapseTwo"
                                       aria-expanded="false" aria-controls="collapseTwo">
                                        @if (Model.Attachments.Count != 0)
                                        {
                                            if (Model.Attachments.Count == 1)
                                            {
                                                @Model.Attachments.Count<span> Attachment</span>
                                            }
                                            else
                                            {
                                                @Model.Attachments.Count<span> Attachments</span>
                                            }
                                        }
                                        else
                                        {
                                            <span>No Attachments</span>
                                        }
                                    </a>
                                </p>
                            </div>
                            <div id="collapseTwo" class="panel-collapse collapse"
                                 role="tabpanel" aria-labelledby="headingTwo">
                                <div class="panel-body">

                                    <table id="datatable-responsive-attachments" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                                        <thead>
                                            <tr>
                                                <th>
                                                    Date Added
                                                </th>
                                                <th>
                                                    File(s)
                                                </th>
                                                <th>
                                                    Description
                                                </th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                            @foreach (var file in Model.Attachments.OrderByDescending(a => a.Created))
                                            {
                                                <tr>
                                                    <td>
                                                        @*@file.Created*@
                                                        @Html.ToUserTime(file.Created, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss")
                                                    </td>
                                                    <td>
                                                        <a href="@file.FileUrl" target="_blank">@file.FileUrl.Substring(file.FileUrl.LastIndexOf("/") + 1)</a>
                                                    </td>
                                                    <td>
                                                        @file.Description
                                                        @*@Html.ActionLink("Edit attachment", "Edit", "TicketAttachments", new { id = file.Id }, null )*@
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>

                                    <hr />

                                    @using (Html.BeginForm("Create", "TicketAttachments", new { TicketId = Model.Id }, FormMethod.Post, new { enctype = "Multipart/form-data" }))
                                    {
                                        @Html.AntiForgeryToken()

                                        <h4>Upload attachment(s)</h4>
                                        <div class="row">
                                            <div class="form-group">
                                                <label class="control-label col-md-2">New file(s)</label>
                                                <div class="col-md-10">
                                                    <input name="attachment" type="file" class="form-control" multiple />
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="control-label col-md-2">File description</label>
                                                <div class="col-md-10">
                                                    <textarea name="Description" class="form-control" style="max-width:none !important; width:100%"></textarea>
                                                    @Html.ValidationMessageFor(model => model.Description, "", new { @class = "text-danger" })
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <div class="col-md-offset-2 col-md-10" style="margin-top:10px">
                                                    <!-- Input/Button to submit the data. -->
                                                    <input type="submit" value="Create attachment" class="btn btn-primary" />
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                        <!-- Histories -->
                        <div class="panel panel-default bx-shadow-none">
                            <div class="panel-heading" role="tab" id="headingThree">
                                <p class="panel-title" style="font-weight:500">
                                    <a class="collapsed" role="button" data-toggle="collapse"
                                       data-parent="#accordion" href="#collapseThree"
                                       aria-expanded="false" aria-controls="collapseThree">
                                        Ticket History:&nbsp;&nbsp;
                                        @if (Model.Histories.Count == 1)
                                        {
                                            <span>@Model.Histories.Count transaction</span>
                                        }
                                        else
                                        {
                                            <span>@Model.Histories.Count transactions</span>
                                        }
                                    </a>
                                </p>
                            </div>
                            <div id="collapseThree" class="panel-collapse collapse"
                                 role="tabpanel" aria-labelledby="headingThree">
                                <div class="panel-body">

                                    <ul class="nav nav-tabs nav-justified">
                                        <li role="presentation" class="active">
                                            <a href="#timeline-display" id="timeline-tab" role="tab" data-toggle="tab" aria-controls="timeline" aria-expanded="true">Timeline View</a>
                                        </li>
                                        <li role="presentation">
                                            <a href="#table-display" role="tab" id="table-tab" data-toggle="tab" aria-controls="table">Table View</a>
                                        </li>
                                    </ul>

                                    <div class="tab-content">
                                        <div role="tabpanel" class="tab-pane fade in active" id="timeline-display" aria-labelledby="timeline-tab">

                                            <div class="row">
                                                <div class="col-sm-4 col-sm-offset-1">
                                                    <div class="panel panel-custom panel-border">
                                                        <div class="panel-heading">
                                                            <h3 class="panel-title">Ticket Status</h3>
                                                        </div>
                                                        <div class="panel-body" style="background-color:#ebeff2; margin-bottom:10px">
                                                            <div class="row">
                                                                <div class="col-sm-1">
                                                                    <span class="timeline timeline-icon bg-success" style="border-radius:50%; width:20px; margin-bottom:10px"><i class="zmdi zmdi-circle" style="margin:4px 0px 0px 4px; color:#ebeff2"></i></span>
                                                                </div>
                                                                <div class="col-sm-8 col-sm-offset-1 text-success">
                                                                    Resolved
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-sm-1">
                                                                    <span class="timeline timeline-icon bg-info" style="border-radius:50%; width:20px; margin-bottom:10px"><i class="zmdi zmdi-circle" style="margin:4px 0px 0px 4px; color:#ebeff2"></i></span>
                                                                </div>
                                                                <div class="col-sm-8 col-sm-offset-1 text-info">
                                                                    In-progress
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-sm-1">
                                                                    <span class="timeline timeline-icon bg-purple" style="border-radius:50%; width:20px; margin-bottom:10px"><i class="zmdi zmdi-circle" style="margin:4px 0px 0px 4px; color:#ebeff2"></i></span>
                                                                </div>
                                                                <div class="col-sm-8 col-sm-offset-1 text-purple">
                                                                    Assigned
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-sm-1">
                                                                    <span class="timeline timeline-icon bg-pink" style="border-radius:50%; width:20px; margin-bottom:0px"><i class="zmdi zmdi-circle" style="margin:4px 0px 0px 4px; color:#ebeff2"></i></span>
                                                                </div>
                                                                <div class="col-sm-8 col-sm-offset-1 text-pink">
                                                                    Unassigned
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div><!-- end col -->
                                                <div class="col-sm-4 col-sm-offset-2">
                                                    <div class="panel panel-custom panel-border">
                                                        <div class="panel-heading">
                                                            <h3 class="panel-title">Ticket Priority</h3>
                                                        </div>
                                                        <div class="panel-body" style="background-color:#ebeff2; margin-bottom:10px">
                                                            <div class="row">
                                                                <div class="col-sm-12" style="text-align:center; margin-bottom:10px">
                                                                    <span class="label label-urgent" style="width:55px">Urgent</span>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-sm-12" style="text-align:center; margin-bottom:10px">
                                                                    <span class="label label-high" style="width:55px !important">High</span>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-sm-12" style="text-align:center; margin-bottom:10px">
                                                                    <span class="label label-medium" style="width:55px">Medium</span>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-sm-12" style="text-align:center; margin-bottom:8px">
                                                                    <span class="label label-low" style="width:55px">Low</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div><!-- end col -->
                                            </div>

                                            <div class="row">
                                                <div class="col-sm-12">

                                                    <!-- Timeline's color is set in a "pre" block -->
                                                    <!-- Timeline background-color -->
                                                    <div class="timeline" style="background-color:#ebeff2">

                                                        <article class="timeline-item alt">
                                                            <div class="text-right">
                                                                <div class="time-show first">
                                                                    <a href="#" class="btn btn-custom w-lg">Latest Event</a>
                                                                </div>
                                                            </div>
                                                        </article>

                                                        @{
                                                            bool alternateLeft = true;

                                                            foreach (var history in Model.Histories.OrderByDescending(h => h.Created))
                                                            {
                                                                if (alternateLeft)
                                                                {
                                                                    <article class="timeline-item alt">
                                                                        <div class="timeline-desk">
                                                                            <div class="panel" style="margin-left:30px">
                                                                                <div class="panel-body">
                                                                                    <span class="arrow-alt"></span>

                                                                                    @{
                                                                                        if (history.HistoricStatus == 1)
                                                                                        {
                                                                                            <span class="timeline-icon bg-success"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 2)
                                                                                        {
                                                                                            <span class="timeline-icon bg-info"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 3)
                                                                                        {
                                                                                            <span class="timeline-icon bg-purple"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 4)
                                                                                        {
                                                                                            <span class="timeline-icon bg-pink"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <span class="timeline-icon bg-muted"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }


                                                                                        if (history.HistoricPriority == 1)
                                                                                        {
                                                                                            <span class="label label-urgent">Urgent</span>
                                                                                        }
                                                                                        else if (history.HistoricPriority == 2)
                                                                                        {
                                                                                            <span class="label label-high">High</span>
                                                                                        }
                                                                                        else if (history.HistoricPriority == 3)
                                                                                        {
                                                                                            <span class="label label-medium">Medium</span>
                                                                                        }
                                                                                        else if (history.HistoricPriority == 4)
                                                                                        {
                                                                                            <span class="label label-low">Low</span>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <span class="label" style="color:rgb(0,0,0)"></span>
                                                                                        }


                                                                                        if (history.HistoricStatus == 1)
                                                                                        {
                                                                                            <h4 class="text text-success" style="margin-top:-30px">@history.Property</h4>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 2)
                                                                                        {
                                                                                            <h4 class="text text-info" style="margin-top:-30px">@history.Property</h4>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 3)
                                                                                        {
                                                                                            <h4 class="text text-purple" style="margin-top:-30px">@history.Property</h4>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 4)
                                                                                        {
                                                                                            <h4 class="text text-pink" style="margin-top:-30px">@history.Property</h4>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <h4 class="text text-muted" style="margin-top:-30px">@history.Property</h4>
                                                                                        }
                                                                                    }
                                                                                    <p class="timeline-date text-muted"><small>@Html.ToUserTime(history.Created, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss")</small></p>
                                                                                    <p style="text-align:left"><span style="font-weight:bold">Old Value: </span>@history.OldValue</p>
                                                                                    <p style="margin-top:-4px !important; text-align:left"><span style="font-weight:bold">New Value: </span>@history.NewValue</p>
                                                                                    <p style="text-align:left"><span style="font-weight:bold">Updated by: </span>@history.Author.Fullname</p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </article>

                                                                    alternateLeft = false;
                                                                }
                                                                else
                                                                {
                                                                    <article class="timeline-item ">
                                                                        <div class="timeline-desk">
                                                                            <div class="panel" style="margin-right:30px">
                                                                                <div class="panel-body">
                                                                                    <span class="arrow"></span>
                                                                                    @{
                                                                                        if (history.HistoricStatus == 1)
                                                                                        {
                                                                                            <span class="timeline-icon bg-success"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 2)
                                                                                        {
                                                                                            <span class="timeline-icon bg-info"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 3)
                                                                                        {
                                                                                            <span class="timeline-icon bg-purple"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 4)
                                                                                        {
                                                                                            <span class="timeline-icon bg-pink"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <span class="timeline-icon bg-muted"><i class="zmdi zmdi-circle" style="margin-top:3px"></i></span>
                                                                                        }


                                                                                        if (history.HistoricPriority == 1)
                                                                                        {
                                                                                            <span class="label label-urgent pull-right">Urgent</span>
                                                                                        }
                                                                                        else if (history.HistoricPriority == 2)
                                                                                        {
                                                                                            <span class="label label-high pull-right">High</span>
                                                                                        }
                                                                                        else if (history.HistoricPriority == 3)
                                                                                        {
                                                                                            <span class="label label-medium pull-right">Medium</span>
                                                                                        }
                                                                                        else if (history.HistoricPriority == 4)
                                                                                        {
                                                                                            <span class="label label-low pull-right">Low</span>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <span class="label pull-right" style="color:rgb(0,0,0)"></span>
                                                                                        }


                                                                                        if (history.HistoricStatus == 1)
                                                                                        {
                                                                                            <h4 class="text text-success" style="margin-top:-10px">@history.Property</h4>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 2)
                                                                                        {
                                                                                            <h4 class="text text-info" style="margin-top:-10px">@history.Property</h4>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 3)
                                                                                        {
                                                                                            <h4 class="text text-purple" style="margin-top:-10px">@history.Property</h4>
                                                                                        }
                                                                                        else if (history.HistoricStatus == 4)
                                                                                        {
                                                                                            <h4 class="text text-pink" style="margin-top:-10px">@history.Property</h4>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <h4 class="text text-muted" style="margin-top:-10px">@history.Property</h4>
                                                                                        }
                                                                                    }
                                                                                    <p class="timeline-date text-muted"><small>@Html.ToUserTime(history.Created, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss")</small></p>
                                                                                    <p style="text-align:left"><span style="font-weight:bold">Old Value: </span>@history.OldValue</p>
                                                                                    <p style="margin-top:-4px !important; text-align:left"><span style="font-weight:bold">New Value: </span>@history.NewValue</p>
                                                                                    <p style="text-align:left"><span style="font-weight:bold">Updated by: </span>@history.Author.Fullname</p>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </article>

                                                                    alternateLeft = true;
                                                                }
                                                            }

                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div role="tabpanel" class="tab-pane fade" id="table-display" aria-labelledby="table-tab">
                                            <table id="datatable-responsive-histories" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                                                <thead>
                                                    <tr>
                                                        <th>Date Created</th>
                                                        <th>Property</th>
                                                        <th>Old Value</th>
                                                        <th>New Value</th>
                                                        <th>Submitter</th>
                                                    </tr>
                                                </thead>

                                                <tbody>
                                                    @foreach (var history in Model.Histories.OrderByDescending(h => h.Created))
                                                    {
                                                        <tr>
                                                            <td>
                                                                @Html.ToUserTime(history.Created, ViewBag.UserTimeZone as string, "MM/dd/yyyy | hh:mm:ss")
                                                            </td>
                                                            <td>
                                                                @history.Property
                                                            </td>
                                                            <td>
                                                                @history.OldValue
                                                            </td>
                                                            <td>
                                                                @history.NewValue
                                                            </td>
                                                            <td>
                                                                @history.Author.Fullname
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div><!-- end panel group -->
                </div><!-- end row -->

            </div><!-- card-box table-responsive -->
        </div><!-- end col -->
    </div><!-- end row -->
</div>


@section scripts
{
    <!-- Datatables-->
    <script src="~/Assets/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/Assets/plugins/datatables/dataTables.bootstrap.js"></script>
    <script src="~/Assets/plugins/datatables/dataTables.buttons.min.js"></script>
    <script src="~/Assets/plugins/datatables/buttons.bootstrap.min.js"></script>
    <script src="~/Assets/plugins/datatables/jszip.min.js"></script>
    <script src="~/Assets/plugins/datatables/pdfmake.min.js"></script>
    <script src="~/Assets/plugins/datatables/vfs_fonts.js"></script>
    <script src="~/Assets/plugins/datatables/buttons.html5.min.js"></script>
    <script src="~/Assets/plugins/datatables/buttons.print.min.js"></script>
    <script src="~/Assets/plugins/datatables/dataTables.fixedHeader.min.js"></script>
    <script src="~/Assets/plugins/datatables/dataTables.keyTable.min.js"></script>
    <script src="~/Assets/plugins/datatables/dataTables.responsive.min.js"></script>
    <script src="~/Assets/plugins/datatables/responsive.bootstrap.min.js"></script>
    <script src="~/Assets/plugins/datatables/dataTables.scroller.min.js"></script>

    <!-- Datatable init js -->
    <script src="~/Assets/pages/datatables.init.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            //$('#datatable').dataTable();
            //$('#datatable-keytable').DataTable({ keys: true });
            $('#datatable-responsive-attachments').DataTable();
            //$('#datatable-responsive-comments').DataTable();
            $('#datatable-responsive-histories').DataTable();
            //$('#datatable-scroller').DataTable({ ajax: "~/Assets/plugins/datatables/json/scroller-demo.json", deferRender: true, scrollY: 380, scrollCollapse: true, scroller: true });
            //var table = $('#datatable-fixed-header').DataTable({ fixedHeader: true });
        });
        TableManageButtons.init();
    </script>
}